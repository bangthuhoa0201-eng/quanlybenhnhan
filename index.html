
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý bệnh nhân</title>

    <style>
        body {
            font-family: Arial;
            background: #f0f2f5;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        th {
            background: #4CAF50;
            color: white;
        }

        form {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
        }

        input, select {
            padding: 8px;
            margin: 5px;
        }

        button {
            padding: 8px 12px;
            border: none;
            cursor: pointer;
            color: white;
        }

        .them {
            background: #4CAF50;
        }

        .xoa {
            background: red;
        }

        .sua {
            background: orange;
        }
    </style>
</head>

<body>

    <h1>Hệ thống quản lý bệnh nhân</h1>

    <input id="timkiem" type="text" placeholder="Tìm bệnh nhân..." onkeyup="timBenhNhan()">

    <form onsubmit="themHoacSua(event)">

        <input id="ten" type="text" placeholder="Tên bệnh nhân" required>

        <input id="tuoi" type="number" placeholder="Tuổi" required>

        <select id="donvituoi">
            <option value="t">Tuổi (t)</option>
            <option value="th">Tháng (th)</option>
        </select>

        <input id="ngaykham" type="date" required>

        <input id="chuandoan" type="text" placeholder="Chuẩn đoán" required>

        <select id="gioitinh">
            <option value="Nam">Nam</option>
            <option value="Nữ">Nữ</option>
            <option value="Khác">Khác</option>
        </select>

        <input id="thuoc" type="text" placeholder="Thuốc điều trị" required>

        <button id="nutThem" class="them" type="submit">Thêm</button>

    </form>

    <table id="bangBenhNhan">
        <tr>
            <th>Tên</th>
            <th>Tuổi</th>
            <th>Ngày khám</th>
            <th>Chuẩn đoán</th>
            <th>Giới tính</th>
            <th>Thuốc điều trị</th>
            <th>Sửa</th>
            <th>Xóa</th>
        </tr>
    </table>

    <script>
        const { ipcRenderer } = require('electron');
        let danhSach = [];
        let indexDangSua = -1;

        window.onload = function () {
            let data = localStorage.getItem("benhnhan");

            if (data) {
                danhSach = JSON.parse(data);
                hienThi();
            }
        }

        async function themHoacSua(event) {
            event.preventDefault();

            let bn = {
                ten: ten.value,
                tuoi: tuoi.value + " " + donvituoi.value,
                ngaykham: ngaykham.value,
                chuandoan: chuandoan.value,
                gioitinh: gioitinh.value,
                thuoc: thuoc.value
            };

            await ipcRenderer.send("them-benh-nhan", bn);

            hienThi();
            document.querySelector("form").reset();
        }

            if (indexDangSua === -1) {
                danhSach.push(bn);
            } else {
                danhSach[indexDangSua] = bn;
                indexDangSua = -1;
                nutThem.innerText = "Thêm";
            }

            localStorage.setItem("benhnhan", JSON.stringify(danhSach));

            hienThi();
            document.querySelector("form").reset();
        }

        function hienThi() {
            let bang = document.getElementById("bangBenhNhan");

            bang.innerHTML = `
                <tr>
                    <th>Tên</th>
                    <th>Tuổi</th>
                    <th>Ngày khám</th>
                    <th>Chuẩn đoán</th>
                    <th>Giới tính</th>
                    <th>Thuốc điều trị</th>
                    <th>Sửa</th>
                    <th>Xóa</th>
                </tr>`;

            danhSach.forEach((bn, index) => {

                let hang = bang.insertRow();

                hang.insertCell(0).innerText = bn.ten;
                hang.insertCell(1).innerText = bn.tuoi + " " + bn.donvi;
                hang.insertCell(2).innerText = bn.ngaykham;
                hang.insertCell(3).innerText = bn.chuandoan;
                hang.insertCell(4).innerText = bn.gioitinh;
                hang.insertCell(5).innerText = bn.thuoc;

                let nutSua = document.createElement("button");
                nutSua.innerText = "✏️";
                nutSua.className = "sua";
                nutSua.onclick = () => suaBenhNhan(index);
                hang.insertCell(6).appendChild(nutSua);

                let nutXoa = document.createElement("button");
                nutXoa.innerText = "❌";
                nutXoa.className = "xoa";
                nutXoa.onclick = () => xoaBenhNhan(index);
                hang.insertCell(7).appendChild(nutXoa);
            });
        }

        function suaBenhNhan(index) {
            let bn = danhSach[index];

            ten.value = bn.ten;
            tuoi.value = bn.tuoi;
            donvituoi.value = bn.donvi;
            ngaykham.value = bn.ngaykham;
            chuandoan.value = bn.chuandoan;
            gioitinh.value = bn.gioitinh;
            thuoc.value = bn.thuoc;

            indexDangSua = index;
            nutThem.innerText = "Cập nhật";
        }

        function xoaBenhNhan(index) {
            if (confirm("Bạn có chắc muốn xóa không?")) {
                danhSach.splice(index, 1);
                localStorage.setItem("benhnhan", JSON.stringify(danhSach));
                hienThi();
            }
        }

        function timBenhNhan() {
            let input = timkiem.value.toLowerCase();
            let rows = document.querySelectorAll("#bangBenhNhan tr");

            rows.forEach((row, index) => {
                if (index === 0) return;

                let ten = row.cells[0].innerText.toLowerCase();
                row.style.display = ten.includes(input) ? "" : "none";
            });
        }

    </script>

</body>
</html>
